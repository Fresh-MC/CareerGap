#------------------------------------------------- PASSWORD POLICIES -----------------------------------------------------------#

- id: "WIN.PASSWORD.COMPLEXITY"
  title: "Enforce password complexity requirements"
  description: "Ensure password complexity policy is enabled"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "local_policy"
  policy_name: "PasswordComplexity"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "local_policy_set"
  set_value: 1

  post_reboot_required: false
  reference: "Password Configuration › Password Complexity"


- id: "WIN.PASSWORD.MIN_LENGTH"
  title: "Set minimum password length"
  description: "Ensure minimum password length is at least 14 characters"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "local_policy"
  policy_name: "MinimumPasswordLength"

  expected_state:
    operator: "gte"
    value: 14

  remediate_type: "local_policy_set"
  set_value: 14

  post_reboot_required: false
  reference: "Password Configuration › Minimum Password Length"


- id: "WIN.PASSWORD.MAX_AGE"
  title: "Set maximum password age"
  description: "Ensure maximum password age is 60 days or less"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "local_policy"
  policy_name: "MaximumPasswordAge"

  expected_state:
    operator: "lte"
    value: 60

  remediate_type: "local_policy_set"
  set_value: 60

  post_reboot_required: false
  reference: "Password Configuration › Maximum Password Age"


- id: "WIN.PASSWORD.MIN_AGE"
  title: "Set minimum password age"
  description: "Ensure minimum password age is at least 1 day"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "local_policy"
  policy_name: "MinimumPasswordAge"

  expected_state:
    operator: "gte"
    value: 1

  remediate_type: "local_policy_set"
  set_value: 1

  post_reboot_required: false
  reference: "Password Configuration › Minimum Password Age"


- id: "WIN.PASSWORD.REVERSIBLE_ENCRYPTION"
  title: "Disable reversible password encryption"
  description: "Ensure passwords are not stored using reversible encryption"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "local_policy"
  policy_name: "ClearTextPassword"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "local_policy_set"
  set_value: 0

  post_reboot_required: false
  reference: "Password Configuration › Reversible Encryption"


- id: "WIN.PASSWORD.MIN_LENGTH_AUDIT"
  title: "Audit minimum password length"
  description: "Ensure minimum password length is set to 14 characters or more"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "local_policy"
  policy_name: "MinimumPasswordLength"

  expected_state:
    operator: "gte"
    value: 14

  remediate_type: "local_policy_set"
  set_value: 14

  post_reboot_required: false
  reference: "Password Configuration › Minimum Length Audit"


- id: "WIN.PASSWORD.RELAX_LENGTH_LIMITS"
  title: "Relax minimum password length limits"
  description: "Allow passwords longer than 14 characters"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "local_policy"
  policy_name: "RelaxMinimumPasswordLengthLimits"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "local_policy_set"
  set_value: 1

  post_reboot_required: true
  reference: "Password Configuration › Relax Length Limits"

- id: "WIN.PASSWORD.HISTORY"
  title: "Enforce password history"
  description: "Ensure users cannot reuse recent passwords"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "local_policy"
  policy_name: "PasswordHistorySize"

  expected_state:
    operator: "gte"
    value: 24

  remediate_type: "local_policy_set"
  set_value: 24

  post_reboot_required: false
  reference: "Password Configuration › Password History"

- id: "WIN.PASSWORD.HISTORY.DOMAIN"
  title: "Enforce password history for all domain users"
  description: "Ensure password history policy is enforced consistently across domain accounts"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "local_policy"
  policy_name: "PasswordHistorySize"

  expected_state:
    operator: "gte"
    value: 24

  remediate_type: "local_policy_set"
  set_value: 24

  post_reboot_required: false
  reference: "Password Configuration › Domain Password History"

#------------------------------------------------- PASSWORD POLICIES -----------------------------------------------------------#

#------------------------------------------------- ACCOUNT POLICIES ------------------------------------------------------------#

- id: "WIN.ACCOUNT.GUEST.DISABLE"
  title: "Disable Guest account"
  description: "Ensure the built-in Guest account is disabled"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "local_policy"
  policy_name: "EnableGuestAccount"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "local_policy_set"
  set_value: 0

  post_reboot_required: false
  reference: "Account Management › Disable Guest"

- id: "WIN.ACCOUNT.ADMIN.RENAME"
  title: "Rename Administrator account"
  description: "Ensure the default Administrator account is renamed"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon"
    value_name: "DefaultUserName"
    value_type: "STRING"

  expected_state:
    operator: "ne"
    value: "Administrator"

  remediate_type: "registry_set"
  set_value: "WinAdmin"

  post_reboot_required: false
  reference: "Account Management › Rename Administrator"

- id: "WIN.ACCOUNT.GUEST.RENAME"
  title: "Rename Guest account"
  description: "Ensure the default Guest account name is not used"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon"
    value_name: "DefaultGuestName"
    value_type: "STRING"

  expected_state:
    operator: "ne"
    value: "Guest"

  remediate_type: "registry_set"
  set_value: "WinGuest"

  post_reboot_required: false

  missing_is_compliant: true
  missing_compliant_message: "Guest account is disabled or removed by default on modern Windows versions"

  reference: "Account Management › Rename Guest"

#------------------------------------------------- ACCOUNT POLICIES ------------------------------------------------------------#

#------------------------------------------------- INTERACTIVE POLICIES --------------------------------------------------------#

- id: "WIN.INTERACTIVE_LOGON.HIDE_LAST_USERNAME"
  title: "Interactive logon: Do not display last user name"
  description: "Ensure the previous username is not displayed on the secure desktop"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "DontDisplayLastUserName"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1

  post_reboot_required: false
  reference: "Interactive Logon › Hide Last Username"

- id: "WIN.INTERACTIVE_LOGON.LEGAL_BANNER"
  title: "Interactive logon: Message text for users attempting to log on"
  description: "Ensure a legal warning banner is displayed to users before logging on"
  platform: "windows"
  severity: "low"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "LegalNoticeText"
    value_type: "STRING"

  expected_state:
    operator: "not_empty"
    value: null

  remediate_type: "registry_set"
  set_value: "Authorized Use Only. All activity is monitored."

  post_reboot_required: false
  reference: "Interactive Logon › Legal Banner"

- id: "WIN.AUTH.WHFB.REQUIRED"
  title: "Interactive logon: Require Windows Hello for Business or smart card"
  description: "Enforce strong multi-factor credentials for interactive logon where supported"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Administrative Templates\\Windows Components\\Windows Hello for Business"
    value_name: "UseWinHelloForBusiness"

  expected_state:
    operator: "eq"
    value: "Enabled"

  remediate_type: "gpo_set"
  set_value: "Enabled"
  post_reboot_required: false
  reference: "Interactive Logon › Windows Hello for Business"

- id: "WIN.AUTH.SMARTCARD.REMOVAL_LOCK"
  title: "Interactive logon: Smart card removal behavior"
  description: "Automatically lock the workstation when a smart card is removed"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "SmartCardRemovalBehavior"

  expected_state:
    operator: "eq"
    value: "Lock Workstation"

  remediate_type: "gpo_set"
  set_value: "Lock Workstation"
  post_reboot_required: false
  reference: "Interactive Logon › Smart Card Removal"


#------------------------------------------------- INTERACTIVE POLICIES --------------------------------------------------------#

#------------------------------------------------- NETWORK POLICIES -----------------------------------------------------------#
- id: "WIN.NETWORK.AUTH.DISABLE_CREDENTIAL_STORAGE"
  title: "Network access: Do not allow storage of passwords and credentials"
  description: "Ensure passwords and credentials are not stored for network authentication"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa"
    value_name: "DisableDomainCreds"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1

  post_reboot_required: true
  reference: "Network Authentication › Disable Credential Storage"

- id: "WIN.NETWORK.AUTH.LM_COMPATIBILITY_LEVEL"
  title: "Network security: LAN Manager authentication level"
  description: "Ensure only NTLMv2 is used (refuse LM and NTLM) to prevent credential theft"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa"
    value_name: "LmCompatibilityLevel"
    value_type: "DWORD"

  expected_state:
    operator: "gte"
    value: 5

  remediate_type: "registry_set"
  set_value: 5
  post_reboot_required: true
  reference: "Network Security › NTLMv2 Only"


- id: "WIN.NETWORK.AUTH.RESTRICT_ANONYMOUS_SAM"
  title: "Network access: Do not allow anonymous enumeration of SAM accounts"
  description: "Prevent anonymous users from listing user accounts on the system"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa"
    value_name: "RestrictAnonymousSAM"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Network Security › Restrict Anonymous SAM"


- id: "WIN.NETWORK.AUTH.RESTRICT_ANONYMOUS_SHARES"
  title: "Network access: Do not allow anonymous enumeration of SAM accounts and shares"
  description: "Prevent anonymous users from listing shares and accounts"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa"
    value_name: "RestrictAnonymous"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Network Security › Restrict Anonymous Enumeration"

- id: "WIN.NETWORK.SMB.DISABLE_SMBV1"
  title: "Disable SMBv1 protocol"
  description: "Ensure SMBv1 protocol is disabled"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters"
    value_name: "SMB1"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "registry_set"
  set_value: 0
  post_reboot_required: true

  missing_is_compliant: true
  missing_compliant_message: "SMBv1 disabled by system defaults"
  reference: "Network Protection › Disable SMBv1"

- id: "WIN.NETWORK.SMB.CLIENT.SIGN_ALWAYS"
  title: "Microsoft network client: Digitally sign communications (always)"
  description: "Require SMB client signing to prevent relay and tampering attacks"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "MicrosoftNetworkClient_SignAlways"

  expected_state:
    operator: "eq"
    value: "Enabled"

  remediate_type: "gpo_set"
  set_value: "Enabled"
  post_reboot_required: false
  reference: "SMB › Client Signing"

- id: "WIN.NETWORK.SMB.CLIENT.NO_PLAINTEXT_PASSWORD"
  title: "Microsoft network client: Send unencrypted password to third-party SMB servers"
  description: "Prevent clear-text passwords from being sent over SMB"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "MicrosoftNetworkClient_SendUnencryptedPassword"

  expected_state:
    operator: "eq"
    value: "Disabled"

  remediate_type: "gpo_set"
  set_value: "Disabled"
  post_reboot_required: false
  reference: "SMB › Block Plaintext Passwords"

- id: "WIN.NETWORK.SMB.SERVER.SIGN_ALWAYS"
  title: "Microsoft network server: Digitally sign communications (always)"
  description: "Require SMB server signing to mitigate MITM attacks"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "MicrosoftNetworkServer_SignAlways"

  expected_state:
    operator: "eq"
    value: "Enabled"

  remediate_type: "gpo_set"
  set_value: "Enabled"
  post_reboot_required: false
  reference: "SMB › Server Signing"

- id: "WIN.NETWORK.SMB.DISCONNECT_EXPIRED_SESSIONS"
  title: "Microsoft network server: Disconnect clients when logon hours expire"
  description: "Enforce logon-hours restrictions on SMB sessions"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "MicrosoftNetworkServer_DisconnectWhenLogonHoursExpire"

  expected_state:
    operator: "eq"
    value: "Enabled"

  remediate_type: "gpo_set"
  set_value: "Enabled"
  post_reboot_required: false
  reference: "SMB › Disconnect Expired Sessions"

- id: "WIN.NETWORK.SMB.SPN_HARDENING"
  title: "Microsoft network server: Server SPN target name validation level"
  description: "Enable SPN validation to prevent SMB relay and replay attacks"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters"
    value_name: "SmbServerNameHardeningLevel"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: true
  reference: "SMB › SPN Hardening"

- id: "WIN.NETWORK.ANONYMOUS.SID_TRANSLATION"
  title: "Network access: Allow anonymous SID/Name translation"
  description: "Disable anonymous SID/Name translation"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "NetworkAccess_AllowAnonymousSIDNameTranslation"

  expected_state:
    operator: "eq"
    value: "Disabled"

  remediate_type: "gpo_set"
  set_value: "Disabled"
  post_reboot_required: false
  reference: "Network Access › Block SID Translation"

- id: "WIN.NETWORK.ANONYMOUS.SAM_ENUMERATION"
  title: "Network access: Do not allow anonymous enumeration of SAM accounts"
  description: "Prevent anonymous SAM enumeration"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "NetworkAccess_DoNotAllowAnonymousEnumerationSAM"

  expected_state:
    operator: "eq"
    value: "Enabled"

  remediate_type: "gpo_set"
  set_value: "Enabled"
  post_reboot_required: false
  reference: "Network Access › Block SAM Enumeration"

- id: "WIN.NETWORK.ANONYMOUS.SAM_AND_SHARES"
  title: "Network access: Do not allow anonymous enumeration of SAM accounts and shares"
  description: "Prevent anonymous enumeration of SAM accounts and shared resources"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "NetworkAccess_DenyAnonymousSAMAndShares"

  expected_state:
    operator: "eq"
    value: "Enabled"

  remediate_type: "gpo_set"
  set_value: "Enabled"
  post_reboot_required: false
  reference: "Network Access › Block SAM and Shares"

- id: "WIN.AUTH.NTLM.MIN_CLIENT_SECURITY"
  title: "Network security: Minimum session security for NTLM SSP based clients"
  description: "Require strong NTLM client session security"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0"
    value_name: "NTLMMinClientSec"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0x20080000

  remediate_type: "registry_set"
  set_value: 0x20080000
  post_reboot_required: false
  reference: "NTLM › Client Minimum Security"

- id: "WIN.AUTH.NTLM.MIN_SERVER_SECURITY"
  title: "Network security: Minimum session security for NTLM SSP based servers"
  description: "Require strong NTLM server session security"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0"
    value_name: "NTLMMinServerSec"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0x20080000

  remediate_type: "registry_set"
  set_value: 0x20080000
  post_reboot_required: false
  reference: "NTLM › Server Minimum Security"

- id: "WIN.AUTH.KERBEROS.STRONG_ENCRYPTION_ONLY"
  title: "Network security: Configure encryption types allowed for Kerberos"
  description: "Restrict Kerberos to strong AES encryption types only"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Kerberos\\Parameters"
    value_name: "SupportedEncryptionTypes"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0x18

  remediate_type: "registry_set"
  set_value: 0x18
  post_reboot_required: true
  reference: "Kerberos › Strong Encryption Only"


#------------------------------------------------- NETWORK POLICIES -----------------------------------------------------------#

#------------------------------------------------- SYSTEM MEMORY --------------------------------------------------------------#

- id: "WIN.SYSTEM.MEMORY.CLEAR_PAGEFILE_ON_SHUTDOWN"
  title: "Shutdown: Clear virtual memory pagefile"
  description: "Ensure the system clears the pagefile upon shutdown to prevent data remnant recovery"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management"
    value_name: "ClearPageFileAtShutdown"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1

  post_reboot_required: true
  reference: "System Hardening › Clear Pagefile on Shutdown"

- id: "WIN.SYSTEM.SECURITY.ENABLE_DEP"
  title: "Enable DEP for all programs"
  description: "Ensure Data Execution Prevention (DEP) is enabled for all programs"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Explorer"
    value_name: "NoDataExecutionPrevention"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "registry_set"
  set_value: 0
  post_reboot_required: false

  missing_is_compliant: true
  missing_compliant_message: "DEP enforced by system defaults"
  reference: "Exploit Mitigation › DEP"


- id: "WIN.SYSTEM.SECURITY.ENABLE_SEHOP"
  title: "Enable structured exception handling overwrite protection"
  description: "Ensure SEHOP is enabled"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\kernel"
    value_name: "DisableExceptionChainValidation"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "registry_set"
  set_value: 0
  post_reboot_required: true
  reference: "Exploit Mitigation › SEHOP"

- id: "WIN.CRYPTO.FORCE_STRONG_KEY_PROTECTION"
  title: "System cryptography: Force strong key protection"
  description: "Require strong protection for private keys"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Cryptography"
    value_name: "ForceKeyProtection"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 2

  remediate_type: "registry_set"
  set_value: 2
  post_reboot_required: false
  reference: "Cryptography › Strong Key Protection"


#------------------------------------------------- SYSTEM MEMORY --------------------------------------------------------------#

#------------------------------------------------- REMOTE POLICIES -----------------------------------------------------------#

- id: "WIN.REMOTE.AUTH.BLOCK_BLANK_PASSWORDS"
  title: "Limit local account use of blank passwords"
  description: "Ensure local accounts with blank passwords cannot be used remotely"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "local_policy"
  policy_name: "LimitBlankPasswordUse"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "local_policy_set"
  set_value: 1

  post_reboot_required: false
  reference: "Remote Authentication › Block Blank Passwords"

- id: "WIN.REMOTE.RDP.REQUIRE_NLA"
  title: "Remote Desktop: Require Network Level Authentication (NLA)"
  description: "Ensure RDP connections require authentication before establishing a session"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp"
    value_name: "UserAuthentication"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Remote Desktop › Require NLA"

#------------------------------------------------- REMOTE POLICIES -----------------------------------------------------------#

#------------------------------------------- USER ACCOUNT CONTROL POLICIES ---------------------------------------------------#

- id: "WIN.UAC.INSTALLER_DETECTION"
  title: "User Account Control: Detect application installations and prompt for elevation"
  description: "Ensure Windows detects installers and prompts for permissions"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "EnableInstallerDetection"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "UAC › Installer Detection"

- id: "WIN.UAC.ENABLE_ADMIN_APPROVAL_MODE"
  title: "User Account Control: Run all administrators in Admin Approval Mode"
  description: "Ensure UAC is enabled for all users, including administrators"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "EnableLUA"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1

  post_reboot_required: true
  reference: "UAC › Enable Admin Approval Mode"

- id: "WIN.UAC.ADMIN_ELEVATION_PROMPT"
  title: "User Account Control: Behavior of the elevation prompt for administrators"
  description: "Ensure the UAC prompt requests consent on the secure desktop"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "ConsentPromptBehaviorAdmin"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 2

  remediate_type: "registry_set"
  set_value: 2

  post_reboot_required: false
  reference: "UAC › Elevation Prompt Behavior"

- id: "WIN.UAC.SECURE_DESKTOP"
  title: "User Account Control: Switch to the secure desktop when prompting for elevation"
  description: "Ensure the desktop is dimmed and locked during UAC prompts"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "PromptOnSecureDesktop"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1

  post_reboot_required: false
  reference: "UAC › Secure Desktop Enforcement"

- id: "WIN.UAC.BUILTIN_ADMIN.APPROVAL_MODE"
  title: "User Account Control: Admin Approval Mode for the Built-in Administrator account"
  description: "Enable Admin Approval Mode for the built-in Administrator account"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "FilterAdministratorToken"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: true
  reference: "UAC › Built-in Administrator Approval Mode"

- id: "WIN.UAC.REQUIRE_SIGNED_EXECUTABLES"
  title: "User Account Control: Only elevate executables that are signed and validated"
  description: "Require digital signatures for elevated applications"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "ValidateAdminCodeSignatures"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "UAC › Require Signed Elevation"

- id: "WIN.UAC.SECURE_UIACCESS_PATHS"
  title: "User Account Control: Only elevate UIAccess apps in secure locations"
  description: "Restrict elevation of UIAccess apps to secure system paths"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "EnableSecureUIAPaths"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "UAC › Secure UIAccess Paths"

- id: "WIN.UAC.SECURE_DESKTOP_REQUIRED"
  title: "User Account Control: Use secure desktop for elevation"
  description: "Ensure elevation prompts occur on the secure desktop"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "PromptOnSecureDesktop"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "UAC › Secure Desktop"

- id: "WIN.UAC.INSTALLER_DETECTION"
  title: "User Account Control: Detect application installations"
  description: "Detect installers requiring elevation and prompt the user"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
    value_name: "EnableInstallerDetection"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "UAC › Installer Detection"


#------------------------------------------- USER ACCOUNT CONTROL POLICIES ---------------------------------------------------#

#------------------------------------------------- USER RIGHTS POLICIES ------------------------------------------------------#

- id: "WIN.USER_RIGHTS.RESTORE_FILES"
  title: "Restore files and directories"
  description: "Ensure 'Restore files and directories' is restricted to Administrators and Backup Operators"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "user_right"
  policy_name: "SeRestorePrivilege"

  expected_state:
    operator: "equals"
    value: ["Administrators", "Backup Operators"]

  remediate_type: "user_right_set"
  set_value: ["Administrators", "Backup Operators"]
  post_reboot_required: false
  reference: "User Rights › Restore Files"


- id: "WIN.USER_RIGHTS.SHUTDOWN_SYSTEM"
  title: "Shut down the system"
  description: "Ensure 'Shut down the system' is restricted to Administrators, Backup Operators, and Users"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "user_right"
  policy_name: "SeShutdownPrivilege"

  expected_state:
    operator: "equals"
    value: ["Administrators", "Backup Operators", "Users"]

  remediate_type: "user_right_set"
  set_value: ["Administrators", "Backup Operators", "Users"]
  post_reboot_required: false
  reference: "User Rights › Shutdown System"


- id: "WIN.USER_RIGHTS.SYNC_DIRECTORY_SERVICE"
  title: "Synchronize directory service data"
  description: "Ensure 'Synchronize directory service data' is set to 'No One'"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "user_right"
  policy_name: "SeSyncAgentPrivilege"

  expected_state:
    operator: "equals"
    value: []

  remediate_type: "user_right_set"
  set_value: []
  post_reboot_required: false
  reference: "User Rights › Sync Directory Service"


- id: "WIN.USER_RIGHTS.TAKE_OWNERSHIP"
  title: "Take ownership of files or other objects"
  description: "Ensure 'Take ownership of files or other objects' is restricted to Administrators"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "user_right"
  policy_name: "SeTakeOwnershipPrivilege"

  expected_state:
    operator: "equals"
    value: ["Administrators"]

  remediate_type: "user_right_set"
  set_value: ["Administrators"]
  post_reboot_required: false
  reference: "User Rights › Take Ownership"

#------------------------------------------------- USER RIGHTS POLICIES ------------------------------------------------------#

#------------------------------------------------- AUDITING POLICIES ------------------------------------------------------#

- id: "WIN.AUDIT.FORCE_SUBCATEGORY"
  title: "Force audit policy subcategory settings"
  description: "Ensure advanced audit policy settings override category-based audit policies"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa"
    value_name: "SCENoApplyLegacyAuditPolicy"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Audit Policy › Force Subcategory"


- id: "WIN.AUDIT.CRASH_ON_FAILURE"
  title: "Shutdown system if unable to log security audits"
  description: "Ensure the system halts when audit logs cannot be written"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa"
    value_name: "CrashOnAuditFail"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: true
  reference: "Audit Policy › Crash on Audit Failure"

- id: "WIN.AUDIT.CREDENTIAL_VALIDATION"
  title: "Audit Credential Validation"
  description: "Log successful and failed credential validation attempts"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "audit_policy"
  policy_name: "Credential Validation"

  expected_state:
    success: true
    failure: true

  remediate_type: "audit_policy_set"
  set_state:
    success: true
    failure: true

  post_reboot_required: false
  reference: "Audit › Credential Validation"


#------------------------------------------------- AUDITING POLICIES ------------------------------------------------------#

#------------------------------------------------- DCOM POLICIES ------------------------------------------------------#

- id: "WIN.DCOM.MACHINE.ACCESS_RESTRICTION"
  title: "DCOM Machine Access Restrictions"
  description: "Restrict DCOM access using secure SDDL configuration"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Ole"
    value_name: "MachineAccessRestriction"
    value_type: "STRING"

  expected_state:
    operator: "eq"
    value: "<SECURE_SDDL>"

  remediate_type: "registry_set"
  set_value: "<SECURE_SDDL>"
  post_reboot_required: false
  reference: "DCOM › Machine Access Restriction"

- id: "WIN.DCOM.MACHINE.LAUNCH_RESTRICTION"
  title: "DCOM Machine Launch Restrictions"
  description: "Restrict DCOM launch permissions using secure SDDL"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Ole"
    value_name: "MachineLaunchRestriction"
    value_type: "STRING"

  expected_state:
    operator: "eq"
    value: "<SECURE_SDDL>"

  remediate_type: "registry_set"
  set_value: "<SECURE_SDDL>"
  post_reboot_required: false
  reference: "DCOM › Machine Launch Restriction"

#------------------------------------------------- DCOM POLICIES ------------------------------------------------------#

#------------------------------------------------- DEVICE POLICIES ------------------------------------------------------#

- id: "WIN.DEVICE.PRINTER.BLOCK_DRIVER_INSTALL"
  title: "Prevent users from installing printer drivers"
  description: "Ensure standard users are blocked from installing printer drivers"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Print\\Providers\\LanMan Print Services\\Servers"
    value_name: "AddPrinterDrivers"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Device Hardening › Block Printer Driver Install"

- id: "WIN.DEVICE.CDROM.LOCAL_ONLY"
  title: "Restrict CD-ROM access to locally logged-on user"
  description: "Ensure CD drives cannot be accessed remotely"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon"
    value_name: "AllocateCDRoms"
    value_type: "STRING"

  expected_state:
    operator: "eq"
    value: "1"

  remediate_type: "registry_set"
  set_value: "1"
  post_reboot_required: false
  reference: "Removable Media › CD-ROM Local Only"


#------------------------------------------------- DEVICE POLICIES ------------------------------------------------------#

#------------------------------------------------- DOMAIN POLICIES ------------------------------------------------------#

- id: "WIN.DOMAIN.NETLOGON.BLOCK_VULNERABLE_CHANNELS"
  title: "Block vulnerable Netlogon secure channel connections"
  description: "Ensure insecure Netlogon connections are blocked"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Services\\Netlogon\\Parameters"
    value_name: "RequireSignOrSeal"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: true
  reference: "Domain Security › Netlogon Secure Channel"

- id: "WIN.DOMAIN.NETLOGON.REFUSE_PASSWORD_CHANGE"
  title: "Refuse machine account password changes"
  description: "Prevent unauthorized attempts to change domain machine account passwords"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Services\\Netlogon\\Parameters"
    value_name: "RefusePasswordChange"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Domain Security › Refuse Machine Password Change"

- id: "WIN.DOMAIN.NETLOGON.MAX_PASSWORD_AGE"
  title: "Maximum machine account password age"
  description: "Limit lifetime of machine account passwords"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Services\\Netlogon\\Parameters"
    value_name: "MaximumPasswordAge"
    value_type: "DWORD"

  expected_state:
    operator: "lte"
    value: 30

  remediate_type: "registry_set"
  set_value: 30
  post_reboot_required: false
  reference: "Domain Security › Machine Password Age"

- id: "WIN.DOMAIN.LDAP.CHANNEL_BINDING"
  title: "LDAP server channel binding token requirements"
  description: "Enforce LDAP channel binding to mitigate MITM and downgrade attacks"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Parameters"
    value_name: "LdapEnforceChannelBinding"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 2

  remediate_type: "registry_set"
  set_value: 2
  post_reboot_required: true
  reference: "LDAP Security › Channel Binding"

- id: "WIN.DOMAIN.LDAP.SIGNING_REQUIRED"
  title: "LDAP server signing requirements"
  description: "Require LDAP signing on domain controllers"
  platform: "windows"
  severity: "critical"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Parameters"
    value_name: "LDAPServerIntegrity"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 2

  remediate_type: "registry_set"
  set_value: 2
  post_reboot_required: true
  reference: "LDAP Security › Signing Required"


#------------------------------------------------- DOMAIN POLICIES ------------------------------------------------------#

#------------------------------------------------- GPO POLICIES ------------------------------------------------------#

- id: "WIN.GPO.SECURE_CHANNEL.ENCRYPT_OR_SIGN"
  title: "Digitally encrypt or sign secure channel data (always)"
  description: "Ensure secure channel data is always encrypted or signed"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "SecureChannel_EncryptOrSignAlways"

  expected_state:
    operator: "eq"
    value: "Enabled"

  remediate_type: "gpo_set"
  set_value: "Enabled"
  post_reboot_required: false
  reference: "GPO › Secure Channel Encryption"

- id: "WIN.GPO.CTRL_ALT_DEL_REQUIRED"
  title: "Interactive logon: Do not require CTRL+ALT+DEL"
  description: "Require users to press CTRL+ALT+DEL at interactive logon"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "gpo"
  gpo:
    path: "Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options"
    value_name: "DisableCAD"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "gpo_set"
  set_value: 0
  post_reboot_required: false
  reference: "Interactive Logon › CTRL+ALT+DEL"



#------------------------------------------------- GPO POLICIES ------------------------------------------------------#

#------------------------------------------------- SERVICES POLICIES -----------------------------------------------------------#

- id: "WIN.SERVICE.<CATEGORY>.<SERVICE_NAME>"
  title: "<Human readable title>"
  description: "<Why this service is disabled>"
  platform: "windows"
  severity: "<low|medium|high>"
  reversible: true

  check_type: "service_status"
  service_name: "<ActualServiceName>"
  expected_state: "stopped_disabled"

  remediate_type: "service_disable"
  remediate_params:
    stop: true
    disable: true

  post_reboot_required: false
  reference: "<Category › Service Hardening>"

- id: "WIN.SERVICE.BLUETOOTH.BTAG"
  title: "Disable Bluetooth Audio Gateway Service"
  description: "Disable unused Bluetooth audio services"
  platform: "windows"
  severity: "low"
  reversible: true

  check_type: "service_status"
  service_name: "BTAGService"
  expected_state: "stopped_disabled"

  remediate_type: "service_disable"
  remediate_params:
    stop: true
    disable: true

  post_reboot_required: false
  reference: "Services › Bluetooth"

#------------------------------------------------- SERVICES POLICIES -----------------------------------------------------------#

#------------------------------------------------- FIREWALL POLICIES -----------------------------------------------------------#

- id: "WIN.FIREWALL.PRIVATE.ENABLED"
  title: "Enable Windows Firewall for Private profile"
  description: "Ensure Windows Firewall is enabled on private networks"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PrivateProfile"
    value_name: "EnableFirewall"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Firewall › Private Profile Enabled"

- id: "WIN.FIREWALL.PRIVATE.BLOCK_INBOUND"
  title: "Block inbound connections for Private profile"
  description: "Block unsolicited inbound traffic on private networks"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PrivateProfile"
    value_name: "DefaultInboundAction"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Firewall › Private Profile Inbound Block"

- id: "WIN.FIREWALL.PRIVATE.ENABLE"
  title: "Enable Windows Firewall for Private profile"
  description: "Ensure Windows Firewall is enabled on private networks"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PrivateProfile"
    value_name: "EnableFirewall"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Firewall › Private › Enabled"


- id: "WIN.FIREWALL.PRIVATE.INBOUND_BLOCK"
  title: "Block inbound connections for Private profile"
  description: "Block unsolicited inbound traffic on private networks"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PrivateProfile"
    value_name: "DefaultInboundAction"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Firewall › Private › Inbound Block"


- id: "WIN.FIREWALL.PRIVATE.OUTBOUND_ALLOW"
  title: "Allow outbound connections for Private profile"
  description: "Allow outbound traffic on private networks"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PrivateProfile"
    value_name: "DefaultOutboundAction"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "registry_set"
  set_value: 0
  post_reboot_required: false
  reference: "Firewall › Private › Outbound Allow"


- id: "WIN.FIREWALL.PRIVATE.DISABLE_NOTIFICATIONS"
  title: "Disable firewall notifications for Private profile"
  description: "Suppress firewall notifications on private networks"
  platform: "windows"
  severity: "low"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PrivateProfile"
    value_name: "DisableNotifications"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Firewall › Private › Notifications"


- id: "WIN.FIREWALL.PRIVATE.LOGGING"
  title: "Configure firewall logging for Private profile"
  description: "Enable logging of dropped and successful connections"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"

  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PrivateProfile\\Logging"
    value_type: "DWORD"

  expected_state:
    composite:
      - value_name: "LogDroppedPackets"
        operator: "eq"
        value: 1
      - value_name: "LogSuccessfulConnections"
        operator: "eq"
        value: 1
      - value_name: "LogFileSize"
        operator: "gte"
        value: 16384

  remediate_type: "registry_set_multiple"
  set_values:
    LogDroppedPackets: 1
    LogSuccessfulConnections: 1
    LogFileSize: 16384

  post_reboot_required: false
  reference: "Firewall › Private › Logging"


- id: "WIN.FIREWALL.PUBLIC.ENABLE"
  title: "Enable Windows Firewall for Public profile"
  description: "Ensure Windows Firewall is enabled on public networks"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile"
    value_name: "EnableFirewall"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Firewall › Public › Enabled"

- id: "WIN.FIREWALL.PUBLIC.STRICT_MODE"
  title: "Enforce strict firewall rules for Public profile"
  description: "Block inbound traffic and disable local rule merging on public networks"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile"
    value_type: "DWORD"

  expected_state:
    composite:
      - value_name: "DefaultInboundAction"
        operator: "eq"
        value: 1
      - value_name: "AllowLocalPolicyMerge"
        operator: "eq"
        value: 0
      - value_name: "AllowLocalIPsecPolicyMerge"
        operator: "eq"
        value: 0

  remediate_type: "registry_set_multiple"
  set_values:
    DefaultInboundAction: 1
    AllowLocalPolicyMerge: 0
    AllowLocalIPsecPolicyMerge: 0

  post_reboot_required: false
  reference: "Firewall › Public › Strict Mode"

- id: "WIN.FIREWALL.PUBLIC.LOGGING"
  title: "Configure firewall logging for Public profile"
  description: "Log dropped and successful connections on public networks"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile\\Logging"
    value_type: "DWORD"

  expected_state:
    composite:
      - value_name: "LogDroppedPackets"
        operator: "eq"
        value: 1
      - value_name: "LogSuccessfulConnections"
        operator: "eq"
        value: 1
      - value_name: "LogFileSize"
        operator: "gte"
        value: 16384

  remediate_type: "registry_set_multiple"
  set_values:
    LogDroppedPackets: 1
    LogSuccessfulConnections: 1
    LogFileSize: 16384

  post_reboot_required: false
  reference: "Firewall › Public › Logging"



#------------------------------------------------- FIREWALL POLICIES -----------------------------------------------------------#

#------------------------------------------------- PERSONALIZATION POLICIES -----------------------------------------------------------#

- id: "WIN.PERSONALIZATION.NO_LOCKSCREEN_CAMERA"
  title: "Disable lock screen camera"
  description: "Prevent camera access from the lock screen"
  platform: "windows"
  severity: "low"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Personalization"
    value_name: "NoLockScreenCamera"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false
  reference: "Personalization › Disable Lock Screen Camera"

#------------------------------------------------- PERSONALIZATION POLICIES -----------------------------------------------------------#

#------------------------------------------------- WINDOWS DEFENDER POLICIES -----------------------------------------------------------#

- id: "WIN.MDAG.AUDIT.ENABLE"
  title: "Audit events in Microsoft Defender Application Guard"
  description: "Enable auditing for Microsoft Defender Application Guard activity"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\AppHVSI"
    value_name: "AuditApplicationGuard"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false

  reference: "MDAG › Audit Events"

- id: "WIN.MDAG.DEVICE.REDIRECTION.DISABLE"
  title: "Disable camera and microphone redirection in MDAG"
  description: "Prevent camera and microphone access inside Application Guard sessions"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\AppHVSI"
    value_name: "AllowCameraMicrophoneRedirection"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "registry_set"
  set_value: 0
  post_reboot_required: false

  reference: "MDAG › Device Redirection"

- id: "WIN.MDAG.PERSISTENCE.DISABLE"
  title: "Disable data persistence in MDAG"
  description: "Prevent data from persisting across Application Guard sessions"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\AppHVSI"
    value_name: "AllowPersistence"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "registry_set"
  set_value: 0
  post_reboot_required: false

  reference: "MDAG › Data Persistence"

- id: "WIN.MDAG.FILE.DOWNLOAD.DISABLE"
  title: "Disable file downloads from MDAG to host"
  description: "Prevent files from being downloaded from Application Guard to the host OS"
  platform: "windows"
  severity: "high"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\AppHVSI"
    value_name: "SaveFilesToHost"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 0

  remediate_type: "registry_set"
  set_value: 0
  post_reboot_required: false

  reference: "MDAG › File Transfer"

- id: "WIN.MDAG.CLIPBOARD.CONFIGURE"
  title: "Configure clipboard behavior for MDAG"
  description: "Control clipboard operations between Application Guard and the host"
  platform: "windows"
  severity: "medium"
  reversible: true

  check_type: "registry"
  registry:
    path: "HKLM\\SOFTWARE\\Policies\\Microsoft\\AppHVSI"
    value_name: "AppHVSIClipboardSettings"
    value_type: "DWORD"

  expected_state:
    operator: "eq"
    value: 1

  remediate_type: "registry_set"
  set_value: 1
  post_reboot_required: false

  reference: "MDAG › Clipboard Control"

  

#------------------------------------------------- WINDOWS DEFENDER POLICIES -----------------------------------------------------------#